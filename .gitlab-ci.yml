#####################
## Pipeline stages
#####################

stages:
  - build
  - test

############################
## Jobs for build stage
############################

build-server:
  stage: build
  needs: []
  image: node:16-alpine
  script:
    - yarn install
    - yarn build

postman-tests:
  stage: test
  needs: []
  image: node:16-alpine
  before_script:
    - echo "ELASTICPATH_CLIENT_ID=${ELASTICPATH_CLIENT_ID}" > .env
    - echo "ELASTICPATH_API_HOST=${ELASTICPATH_API_HOST}" >> .env
  script:
    - yarn install
    - yarn dev&
    - sleep 5
    - yarn test
  artifacts:
    when: always
    expire_in: 3 days
    name: ${CI_PROJECT_PATH_SLUG}-${CI_COMMIT_REF_SLUG}-${CI_PIPELINE_ID}-${CI_JOB_NAME}
    paths:
      - build/reports
    reports:
      junit:
        - build/reports/postman-collection-report-junit.xml
